/*

Author: PyroCMS Dev Team / AI Web Systems, Inc. - Ryan Thompson

*//**
 * Messenger defaults
 */Messenger.options={extraClasses:"messenger-fixed messenger-on-top messenger-on-right",theme:"admin"};if(typeof pyro=="undefined")var pyro={};$(window).keypress(function(e){if(e.ctrlKey)switch(e.which){case 19:$("#search-api .search-input").select();break;case 4:e.shiftKey?window.open(SITE_URL+"admin"):window.location=SITE_URL+"admin"}});jQuery(function(e){pyro.cache={url_titles:{}};pyro.is_mobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent);e.ajaxSetup({converters:{"text json":function(t){var n=e.parseJSON(t);!e.ajaxSettings.allowEmpty&&(n==null||e.isEmptyObject(n))&&e.error("The server is not responding correctly, please try again later.");return n}},data:{csrf_hash_name:e.cookie(pyro.csrf_cookie_name)}});pyro.init_ckeditor_maximize=function(){typeof CKEDITOR!="undefined"&&e.each(CKEDITOR.instances,function(t){CKEDITOR.instances[t].on("maximize",function(t){if(t.data==1){e(".	").addClass("hidden");e(".cke_button__maximize").addClass("ckeditor-pyro-logo")}else if(t.data==2){e(".hide-on-ckeditor-maximize").removeClass("hidden");e(".cke_button__maximize").removeClass("ckeditor-pyro-logo")}})})};pyro.init_autocomplete_search=function(){var t=[],n={};e("#search-api .search-input").typeahead({minLength:3,source:function(r,i){return e.getJSON(SITE_URL+"admin/search/ajax_autocomplete",{term:r},function(r){e.each(r.results,function(e,r){t[e]="<strong>"+r.title+"</strong><br/><small>"+r.singular+"</small>";n["<strong>"+r.title+"</strong><br/><small>"+r.singular+"</small>"]=r});return i(t)})},updater:function(e,t){window.location=n[e].url}})};pyro.init=function(){e("header aside nav#primary ul li ul li.current").closest("ul").closest("li").addClass("has_current");e(".check-all").bind("click",function(){var t=e(this),n=e(this).is(".grid-check-all")?e(this).parents(".list-items").find(".grid input[type='checkbox']"):e(this).parents("table").find("tbody input[type='checkbox']");n.each(function(){t.is(":checked")&&!e(this).is(":checked")?e(this).click():!t.is(":checked")&&e(this).is(":checked")&&e(this).click()});e(".table_action_buttons .btn").prop("disabled",!1)});e(".table_action_buttons .btn").prop("disabled",!0);e('input[name="action_to[]"], .check-all').bind("click",function(){e('input[name="action_to[]"]:checked, .check-all:checked').length>=1?e(".table_action_buttons .btn").prop("disabled",!1):e(".table_action_buttons .btn").prop("disabled",!0)});e(".confirm").on("click",function(t){t.preventDefault();var n=e(this).attr("href"),r=e(this).attr("title");if(confirm(r||pyro.lang.dialog_message)){e(this).trigger("click-confirmed");if(e.data(this,"stop-click")){e.data(this,"stop-click",!1);return}window.location.replace(n)}});e(":submit.confirm".body).on("click",function(t,n){if(n)return!0;t.preventDefault();var r=e(this).attr("title");if(confirm(r||pyro.lang.dialog_message)){e(this).trigger("click-confirmed");if(e(this).data("stop-click")){e(this).data("stop-click",!1);return}e(this).trigger("click",!0)}});e(document.body).on("click",'[data-toggle="modal"]',function(t){t.preventDefault();e(".modal-backdrop").remove();var n=e(this).attr("href");if(n.indexOf("#")!=0){var r=e("#ajax-modal");e("body").modalmanager("loading");r.html("").load(n,function(){r.modal()});return!1}e(n).modal("open")});e.timeago.settings.allowFuture=!0;e("abbr.timeago").timeago();e(document).ajaxComplete(function(){e.timeago.settings.allowFuture=!0;e("abbr.timeago").timeago()});e("[data-persistent-tabs]").find('a[data-toggle="tab"]').on("shown",function(t){e.cookie("last_tab",e(t.target).attr("href"));e.cookie("last_tab_nav",e(t.target).closest(".nav.nav-tabs").data("persistent-tabs"))});e.cookie("last_tab")&&e.cookie("last_tab_nav")&&e('[data-persistent-tabs^="'+e.cookie("last_tab_nav")+'"]').find("a[href="+e.cookie("last_tab")+"]").tab("show");e(document).on("click",'[data-toggle^="toggle"]',function(){var t=e(this).data("target");e(t).toggle();e(this).data("persistent")&&e.cookie("toggle"+t,e(t).is(":visible"),{expires:365,path:"/"});e(t).is(":visible")?e(this).find("i").removeClass("icon-chevron-"+e(this).data("collapsed-chevron")).addClass("icon-chevron-down"):e(t).length>0&&e(this).find("i").addClass("icon-chevron-down").addClass("icon-chevron-"+e(this).data("collapsed-chevron"));return!1});e('[data-toggle^="toggle"][data-persistent^="true"]').each(function(){if(e(this).data("state")!=undefined)return!0;var t=e(this).data("target");e.cookie("toggle"+t)=="false"&&e(t).toggle();e(t).is(":visible")?e(this).find("i").removeClass("icon-chevron-"+e(this).data("collapsed-chevron")).addClass("icon-chevron-down"):e(t).length>0&&e(this).find("i").addClass("icon-chevron-down").addClass("icon-chevron-"+e(this).data("collapsed-chevron"))});e('[data-toggle^="toggle"][data-state]').each(function(){var t=e(this).data("target");e(this).data("state")=="hidden"?e(t).hide():e(t).show()})};pyro.sort_tree=function(t,n,r,i,s,o){o=o||{};t.find("ul").children().hide();var u=function(){t.find("li:has(li:visible)").removeClass().addClass("minus");t.find("li:has(li:hidden)").removeClass().addClass("plus");e(".plus, .minus").find("ul").not(":has(li)").remove();t.find("li:not(:has(ul li))").removeClass();s&&s()};u();e(e.cookie(r)).has("ul").toggleClass("minus plus");e(e.cookie(r)).children("ul").children().show();t.find("li").bind("click",function(){e(this).children("ul").children().slideToggle("fast");e(this).has("ul").toggleClass("minus plus");var n=[];t.find("li.minus:visible").each(function(){n.push("#"+this.id)});e.cookie(r,n.join(", "),{expires:1});return!1});var a={delay:100,disableNesting:"no-nest",forcePlaceholderSize:!0,handle:"div",helper:"clone",items:"li",opacity:.4,placeholder:"placeholder",tabSize:25,listType:"ul",tolerance:"pointer",toleranceElement:"> div",update:function(r,s){post={};post.order=t.nestedSortable("toHierarchy");i&&(post.data=i(r,s));u();e.post(SITE_URL+n,post)}};t.nestedSortable(e.extend({},a,o))};pyro.chosen=function(){pyro.is_mobile||e("select:not(.skip)").chosen()};pyro.generate_slug=function(t,n,r,i){r=r||"-";e(t).slugify({slug:n,type:r})};pyro.filter={$content:e("#filter-stage"),$filter_form:e("#filters form"),f_module:e('input[name="f_module"]').val(),init:function(){e("a.cancel").button();e("select",pyro.filter.$filter_form).on("change",function(){form_data=pyro.filter.$filter_form.serialize();pyro.filter.do_filter(pyro.filter.f_module,form_data)});e('input[type="text"]',pyro.filter.$filter_form).on("keyup",function(){form_data=pyro.filter.$filter_form.serialize();pyro.filter.do_filter(pyro.filter.f_module,form_data)});e("a.cancel",pyro.filter.$filter_form).click(function(){e("select",pyro.filter.$filter_form).val("0");e('input[type="text"]').val("");form_data=pyro.filter.$filter_form.serialize();pyro.filter.do_filter(pyro.filter.f_module,form_data)});pyro.filter.$filter_form.submit(function(e){e.preventDefault()});pyro.filter.$filter_form.find("select").first().trigger("change")},do_filter:function(t,n,r){form_action=pyro.filter.$filter_form.attr("action");post_url=form_action?form_action:SITE_URL+"admin/"+t;typeof r!="undefined"&&(post_url=r);pyro.filter.$content.fadeOut("fast",function(){e.post(post_url,n,function(e,t,n){var r=n.getResponseHeader("content-type")||"",i="";if(r.indexOf("application/json")>-1&&typeof e=="object"){i="html"in e?e.html:"";pyro.filter.handler_response_json(e)}else i=e;pyro.chosen();pyro.filter.$content.html(i).fadeIn("fast")})})},handler_response_json:function(t){"update_filter_field"in t&&typeof t.update_filter_field=="object"&&e.each(t.update_filter_field,pyro.filter.update_filter_field)},update_filter_field:function(e,t){var n=pyro.filter.$filter_form.find("[name="+e+"]");if(n.is("select")&&typeof t=="object"&&"options"in t){var r,i;r=n.val();n.children("option").remove();for(i in t.options)n.append('<option value="'+i+'"'+(i==r?' selected="selected"':"")+">"+t.options[i]+"</option>")}}};e(document).ready(function(){pyro.init();pyro.chosen();pyro.filter.init();pyro.init_ckeditor_maximize();pyro.init_autocomplete_search()});e('[data-toggle^="tooltip"]').tooltip();e('[data-toggle^="popover"]').popover();e(document).ajaxComplete(function(){e('[data-toggle^="popover"]').popover()});e('[data-toggle^="datepicker"]').datepicker();e('[data-toggle^="timepicker"]').timepicker();e(".nav.nav-tabs.mouseover li a").bind("mouseover",function(){e(this).trigger("click")});e(".html_editor").each(function(){CodeMirror.fromTextArea(this,{mode:"text/html",tabMode:"indent",height:"500px",width:"500px"})});e(".css_editor").each(function(){CodeMirror.fromTextArea(this,{mode:"css",tabMode:"indent",height:"500px",width:"500px"})});e(".js_editor").each(function(){CodeMirror.fromTextArea(this,{mode:"javascript",tabMode:"indent",height:"500px",width:"500px"})})});